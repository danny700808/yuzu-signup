<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>柚子樂器成果展｜報名</title>
  <style>
    *{ box-sizing:border-box; }
    html,body{ width:100%; overflow-x:hidden; }
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Noto Sans TC",sans-serif;
      background:#faf7f8; color:#222;
    }
    .wrap{ max-width:820px; margin:24px auto; padding:16px; }
    .card{
      background:#fff; border:1px solid #eee; border-radius:16px;
      padding:18px; box-shadow:0 8px 22px rgba(0,0,0,.06);
    }
    h1{ margin:0 0 10px; font-size:22px; }
    .muted{ color:#666; font-size:13px; line-height:1.6; }
    label{ display:block; margin:12px 0 6px; font-weight:800; }
    input,select,textarea{
      width:100%; max-width:100%;
      display:block; padding:12px;
      border:1px solid #ddd; border-radius:12px;
      font-size:16px; background:#fff;
    }
    textarea{ min-height:90px; resize:vertical; }
    .row{
      display:grid;
      grid-template-columns:minmax(0,1fr) minmax(0,1fr);
      gap:12px;
    }
    @media (max-width:640px){ .row{ grid-template-columns:1fr; } }
    .btn{
      margin-top:14px; width:100%;
      padding:12px; border:0; border-radius:12px;
      font-size:16px; background:#7b3a52; color:#fff; cursor:pointer;
    }
    .btn2{
      margin-top:10px; width:100%;
      padding:12px; border:0; border-radius:12px;
      font-size:16px; background:#2f8f7b; color:#fff; cursor:pointer;
    }
    .btnGhost{
      margin-top:10px; width:100%;
      padding:12px; border:1px solid #ddd; border-radius:12px;
      font-size:16px; background:#fff; color:#333; cursor:pointer;
    }
    .ok{ color:#0a7a3c; font-weight:900; }
    .err{ color:#b00020; font-weight:900; }
    .box{
      background:#f6fbf9; border:1px solid #d7efe7;
      border-radius:12px; padding:12px; margin-top:14px;
    }
    code{ background:#f6f6f6; padding:2px 6px; border-radius:8px; }
    a{ word-break:break-all; }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h1>柚子樂器成果展｜報名</h1>
    <p class="muted">
      音檔上傳方式：先送出基本資料 → 取得「報名編號」→ 上傳到暫存資料夾（檔名要含報名編號）→ 系統會自動整理到安全資料夾並回寫到後台表格。<br>
      MP3 ≤ 15MB；WAV ≤ 80MB。
    </p>

    <form id="f">
      <label>場次 *</label>
      <select name="場次" required>
        <option value="">請選擇</option>
        <option>下午場 13:00~16:00</option>
        <option>晚上場 17:30~20:30</option>
      </select>

      <label>表演項目 *</label>
      <select name="表演項目" required>
        <option value="">請選擇</option>
        <option>熱音樂團</option><option>輕音樂團</option><option>吉他彈唱</option>
        <option>鋼琴獨奏</option><option>鋼琴雙人</option><option>小提琴</option>
        <option>中國笛</option><option>長笛木笛直笛</option><option>爵士鼓獨奏</option>
        <option>鋼琴彈唱</option><option>二胡</option><option>琵琶</option><option>其他</option>
      </select>

      <label>學生姓名 *</label>
      <input name="學生姓名" required placeholder="例：王小明">

      <label>表演者姓名 / 團名 *</label>
      <input name="表演者姓名/團名" required placeholder="例：@@吉他社 / @@小提琴中心">

      <div class="row">
        <div>
          <label>舞台總表演人數 *</label>
          <input name="舞台總表演人數" required inputmode="numeric" placeholder="例：2 / 4">
        </div>
        <div>
          <label>聯絡電話 *</label>
          <input name="聯絡電話" required inputmode="tel" placeholder="例：0952-010146">
        </div>
      </div>

      <label>表演歌名/名稱 *</label>
      <input name="表演歌名/名稱" required placeholder="例：浪流連">

      <label>聯絡人信箱（老師代報也填老師信箱） *</label>
      <input name="聯絡人信箱" type="email" required placeholder="example@example.com">

      <label>老師是否一同表演</label>
      <select name="老師是否一同表演">
        <option value="">請選擇</option><option>是</option><option>否</option>
      </select>

      <label>老師一起的方式（沒有就留空）</label>
      <input name="老師一起的方式" placeholder="例：鋼琴伴奏">

      <label>老師姓名(代報填)</label>
      <input name="老師姓名(代報填)" placeholder="例：黃明廷">

      <label>需求/備註</label>
      <textarea name="需求/備註" placeholder="想補充的內容…"></textarea>

      <button class="btn" type="submit" id="btn">送出報名</button>
      <p id="msg" class="muted"></p>

      <div class="box" id="after" style="display:none;">
        <div class="muted" id="afterInfo"></div>
        <div class="muted" style="margin-top:8px">
          請到暫存資料夾上傳音檔，檔名請務必包含報名編號：<br>
          <code id="rule"></code>
        </div>
        <button type="button" class="btn2" id="openIntake">開啟暫存上傳資料夾</button>
        <button type="button" class="btnGhost" id="skip">我先不上傳（完成）</button>
        <p class="muted" id="hint"></p>
      </div>
    </form>
  </div>
</div>

<script>
  // ✅ 你的 Apps Script Web App URL（你已給我）
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyIrw2PjHkWhlMytY9BmCnXVRsIFOTp3iPAp_2C0rP6gQxe19FvTDSwm7kphUmDjZo_/exec";

  // ✅ 暫存資料夾分享連結（請貼「暫存夾」的分享網址）
  const INTAKE_UPLOAD_LINK = "https://drive.google.com/drive/folders/1N32KMZd0HL7QLHm4uB_kUCnqMW2aN9ky";

  const f = document.getElementById("f");
  const btn = document.getElementById("btn");
  const msg = document.getElementById("msg");

  f.addEventListener("submit", async (ev) => {
    ev.preventDefault();
    msg.className = "muted";
    msg.textContent = "送出中…";
    btn.disabled = true;

    const data = Object.fromEntries(new FormData(f).entries());
    data.mode = "create";

    try{
      const r = await fetch(SCRIPT_URL, {
        method:"POST",
        headers:{ "Content-Type":"text/plain;charset=utf-8" },
        body: JSON.stringify(data)
      });
      const j = await r.json();

      if(j.ok){
        msg.className = "ok";
        msg.textContent = "✅ 基本資料已送出！信箱也會收到確認信。";

        const regId = j.regId;
        const student = (data["學生姓名"]||"").trim();
        const song = (data["表演歌名/名稱"]||"").trim();

        document.getElementById("after").style.display = "";
        document.getElementById("afterInfo").innerHTML =
          `你的報名編號：<b>${regId}</b><br>學生姓名：<b>${student}</b>　歌名：<b>${song}</b>`;
        document.getElementById("rule").textContent = `${regId}_${student}_${song}.mp3（或 .wav）`;

        document.getElementById("openIntake").onclick = () => window.open(INTAKE_UPLOAD_LINK, "_blank");
        document.getElementById("skip").onclick = () => {
          document.getElementById("hint").textContent = "✅ 已完成報名。你之後仍可補上傳（檔名要含報名編號）。";
        };
      }else{
        msg.className = "err";
        msg.textContent = "送出失敗：" + (j.error || "unknown");
      }
    }catch(e){
      msg.className = "err";
      msg.textContent = "送出失敗：" + e.message;
    }finally{
      btn.disabled = false;
    }
  });
</script>
</body>
</html>

